<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT Translator</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f4f7f6; margin: 0; }
        .card { background: #fff; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        h2 { color: #333; }
        input { width: 100%; margin: 1rem 0; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        #translateBtn { background: #007bff; color: #fff; }
        #translateBtn:disabled { background: #ccc; }
        #downloadBtn { background: #28a745; color: #fff; display: none; } /* á€¡á€…á€™á€¾á€¬ á€–á€»á€±á€¬á€€á€ºá€‘á€¬á€¸á€™á€šá€º */
        #status { font-size: 14px; margin: 10px 0; color: #666; min-height: 40px; }
    </style>
</head>
<body>

<div class="card">
    <h2>SRT Translator</h2>
    <input type="file" id="fileInput" accept=".srt">
    <button id="translateBtn">Translate Now</button>
    
    <div id="status">á€–á€­á€¯á€„á€ºá€›á€½á€±á€¸á€•á€¼á€®á€¸ Translate á€”á€¾á€­á€•á€ºá€•á€«</div>

    <button id="downloadBtn" type="button">ðŸ“¥ Download SRT File</button>
</div>

<script>
    let finalSrtContent = ""; // á€˜á€¬á€žá€¬á€•á€¼á€”á€ºá€•á€¼á€®á€¸á€žá€¬á€¸ á€…á€¬á€žá€¬á€¸ á€žá€­á€™á€ºá€¸á€–á€­á€¯á€·

    const fileInput = document.getElementById('fileInput');
    const translateBtn = document.getElementById('translateBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const status = document.getElementById('status');

    translateBtn.onclick = async () => {
        if (!fileInput.files[0]) return alert("SRT á€–á€­á€¯á€„á€ºá€¡á€›á€„á€ºá€›á€½á€±á€¸á€•á€«");

        translateBtn.disabled = true;
        downloadBtn.style.display = "none";
        status.innerText = "â³ á€˜á€¬á€žá€¬á€•á€¼á€”á€ºá€”á€±á€žá€Šá€º... á€á€á€…á€±á€¬á€„á€·á€ºá€•á€«á‹";

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
            const response = await fetch("/api/translate", {
                method: "POST",
                body: formData
            });

            const result = await response.json();

            if (result.success && result.translatedText) {
                finalSrtContent = result.translatedText; // á€…á€¬á€žá€¬á€¸á€€á€­á€¯ Variable á€‘á€² á€žá€­á€™á€ºá€¸á€œá€­á€¯á€€á€ºá€•á€¼á€®
                status.innerText = "âœ… á€˜á€¬á€žá€¬á€•á€¼á€”á€ºá€á€¼á€„á€ºá€¸ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€žá€Šá€ºá‹";
                downloadBtn.style.display = "block"; // Download á€á€œá€¯á€á€ºá€€á€­á€¯ á€–á€±á€¬á€ºá€œá€­á€¯á€€á€ºá€•á€¼á€®
            } else {
                status.innerText = "âŒ Error: " + (result.error || "á€™á€žá€­á€›á€žá€±á€¬á€¡á€™á€¾á€¬á€¸");
                translateBtn.disabled = false;
            }
        } catch (err) {
            status.innerText = "âŒ Server á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯ á€¡á€™á€¾á€¬á€¸á€›á€¾á€­á€žá€Šá€ºá‹";
            translateBtn.disabled = false;
        }
    };

    // Download á€œá€¯á€•á€ºá€á€²á€· á€¡á€•á€­á€¯á€„á€ºá€¸á€€á€­á€¯ á€žá€®á€¸á€žá€”á€·á€º á€›á€±á€¸á€‘á€¬á€¸á€á€¼á€„á€ºá€¸
    downloadBtn.addEventListener('click', function() {
        if (!finalSrtContent) {
            alert("Download á€œá€¯á€•á€ºá€…á€›á€¬ á€–á€­á€¯á€„á€ºá€™á€›á€¾á€­á€žá€±á€¸á€•á€«á‹");
            return;
        }

        // á€˜á€¬á€žá€¬á€•á€¼á€”á€ºá€•á€¼á€®á€¸á€žá€¬á€¸ á€…á€¬á€žá€¬á€¸á€€á€­á€¯ Blob á€•á€¼á€±á€¬á€„á€ºá€¸á€™á€šá€º
        const blob = new Blob([finalSrtContent], { type: 'text/srt;charset=utf-8' });
        const url = window.URL.createObjectURL(blob);
        
        // á€šá€¬á€šá€® Link á€á€…á€ºá€á€¯ á€–á€”á€ºá€á€®á€¸á€•á€¼á€®á€¸ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€”á€¾á€­á€•á€ºá€™á€šá€º
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', 'translated_myanmar.srt');
        document.body.appendChild(link);
        
        link.click(); // á€’á€®á€™á€¾á€¬ Download á€…á€œá€¯á€•á€ºá€•á€«á€œá€­á€™á€·á€ºá€™á€šá€º
        
        // á€•á€¼á€”á€ºá€–á€»á€€á€ºá€™á€šá€º
        setTimeout(() => {
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }, 200);
    });
</script>

</body>
</html>
