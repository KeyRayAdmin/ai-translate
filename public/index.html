<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT Translator</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h2 { color: #1a73e8; margin-bottom: 1.5rem; }
        input[type="file"] { margin: 1rem 0; padding: 10px; border: 1px dashed #ccc; width: 100%; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #translateBtn { background: #1a73e8; color: white; }
        #translateBtn:disabled { background: #ccc; cursor: not-allowed; }
        #downloadBtn { background: #34a853; color: white; display: none; margin-top: 15px; }
        #status { margin-top: 15px; font-size: 14px; color: #555; line-height: 1.5; }
    </style>
</head>
<body>

<div class="card">
    <h2>SRT Translator</h2>
    <input type="file" id="fileInput" accept=".srt">
    <button id="translateBtn">Translate to Burmese</button>
    <div id="status"></div>
    <a id="downloadAnchor" style="display:none;"></a>
    <button id="downloadBtn">ğŸ“¥ Download Translated File</button>
</div>

<script>
    let translatedData = "";

    document.getElementById('translateBtn').onclick = async () => {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const btn = document.getElementById('translateBtn');
        const dlBtn = document.getElementById('downloadBtn');

        if (!fileInput.files[0]) return alert("á€–á€­á€¯á€„á€ºá€¡á€›á€„á€ºá€›á€½á€±á€¸á€•á€«");

        status.innerHTML = "â³ á€˜á€¬á€á€¬á€•á€¼á€”á€ºá€”á€±á€á€Šá€º... <br><small>á€…á€€á€¹á€€á€”á€·á€º áƒá€ á€€á€»á€±á€¬á€ºá€•á€«á€€ Timeout á€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</small>";
        btn.disabled = true;
        dlBtn.style.display = "none";

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
            const response = await fetch("/api/translate", {
                method: "POST",
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                translatedData = result.translatedText;
                status.innerHTML = "âœ… á€˜á€¬á€á€¬á€•á€¼á€”á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹";
                dlBtn.style.display = "block";
            } else {
                status.innerHTML = "âŒ Error: " + (result.error || "á€˜á€¬á€á€¬á€•á€¼á€”á€ºá€œá€­á€¯á€·á€™á€›á€•á€«á‹");
            }
        } catch (error) {
            status.innerHTML = "âŒ Server á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯ á€¡á€™á€¾á€¬á€¸á€›á€¾á€­á€”á€±á€á€Šá€ºá‹";
            console.error(error);
        } finally {
            btn.disabled = false;
        }
    };

    // Download Logic á€€á€­á€¯ á€•á€­á€¯á€™á€­á€¯á€á€­á€¯á€„á€ºá€™á€¬á€¡á€±á€¬á€„á€º á€•á€¼á€„á€ºá€†á€„á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸
    document.getElementById('downloadBtn').onclick = () => {
        if (!translatedData) return;

        try {
            const blob = new Blob([translatedData], { type: 'text/srt;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.style.display = 'none';
            a.href = url;
            a.download = 'translated_myanmar.srt';
            
            document.body.appendChild(a);
            a.click();
            
            // á€á€á€”á€±á€›á€„á€º Memory á€‘á€²á€€ á€•á€¼á€”á€ºá€–á€»á€€á€ºá€™á€šá€º
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 100);
        } catch (err) {
            alert("Download á€†á€½á€²á€›á€”á€º á€¡á€™á€¾á€¬á€¸á€á€…á€ºá€á€¯á€›á€¾á€­á€”á€±á€•á€«á€á€Šá€º: " + err.message);
        }
    };
</script>

</body>
</html>
